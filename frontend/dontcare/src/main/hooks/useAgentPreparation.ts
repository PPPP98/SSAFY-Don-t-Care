import { useAgentWorkflowStore } from '@/main/stores/agentWorkflowStore';
import { useEffect, useRef, useState } from 'react';

// ë™ì  A2A ì—ì´ì „íŠ¸ ê¸°ë°˜ ë©”ì‹œì§€ ì‹œìŠ¤í…œ
const AGENT_MESSAGES = {
  // ì´ˆê¸° ë‹¨ê³„: Root Agent í™œì„±í™” ì‹œ (15ê°œë¡œ í™•ì¥)
  initial: [
    'ë¹„ì„œ ì‹¤ì¥ì´ ìš”ì²­ì‚¬í•­ì„ ì¢…í•©ì ìœ¼ë¡œ ê²€í† í•˜ê³  ìˆìŠµë‹ˆë‹¤...',
    'ì§ˆë¬¸ì˜ í•µì‹¬ì„ íŒŒì•…í•˜ê³  ìµœì ì˜ ë¶„ì„ ì „ëµì„ ìˆ˜ë¦½ ì¤‘ì…ë‹ˆë‹¤...',
    'ì–´ë–¤ ì „ë¬¸ê°€ë“¤ì´ í•„ìš”í•œì§€ ì‹ ì¤‘íˆ íŒë‹¨í•˜ê³  ìˆìŠµë‹ˆë‹¤...',
    'ë¶„ì„ ë²”ìœ„ë¥¼ ê²°ì •í•˜ê³  ì„¸ë¶€ ì‘ì—… ê³„íšì„ ì„¸ìš°ê³  ìˆìŠµë‹ˆë‹¤...',
    'ìš”ì²­ì‚¬í•­ì˜ ë³µì¡ë„ë¥¼ í‰ê°€í•˜ê³  ì ì ˆí•œ ì ‘ê·¼ë²•ì„ ì„ íƒí•˜ê³  ìˆìŠµë‹ˆë‹¤...',
    'ê°€ì¥ ì •í™•í•œ ë‹µë³€ì„ ìœ„í•´ í•„ìš”í•œ ë°ì´í„°ë¥¼ ì‹ë³„í•˜ê³  ìˆìŠµë‹ˆë‹¤...',
    'ì‹œì¥ ìƒí™©ê³¼ ë§¥ë½ì„ ê³ ë ¤í•œ ë¶„ì„ ë°©í–¥ì„ ì„¤ì •í•˜ê³  ìˆìŠµë‹ˆë‹¤...',
    'ì „ë¬¸ê°€ë³„ ì—­í•  ë¶„ë‹´ê³¼ ìš°ì„ ìˆœìœ„ë¥¼ ì¡°ì •í•˜ê³  ìˆìŠµë‹ˆë‹¤...',
    'ì¢…í•©ì ì¸ ê´€ì ì—ì„œ ë¶„ì„ ì²´ê³„ë¥¼ êµ¬ì¶•í•˜ê³  ìˆìŠµë‹ˆë‹¤...',
    'ì •í™•í•˜ê³  ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ê²°ê³¼ë¥¼ ìœ„í•´ ê²€ì¦ ì²´ê³„ë¥¼ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤...',
    'ë‹¤ê°ë„ ë¶„ì„ì„ ìœ„í•œ ì „ë¬¸íŒ€ êµ¬ì„±ì„ ì™„ë£Œí•˜ê³  ìˆìŠµë‹ˆë‹¤...',
    'ì²´ê³„ì ì´ê³  ë…¼ë¦¬ì ì¸ ì ‘ê·¼ì„ ìœ„í•´ ë¶„ì„í‹€ì„ ì„¤ê³„í•˜ê³  ìˆìŠµë‹ˆë‹¤...',
    'ìµœì‹  ì •ë³´ì™€ ë°ì´í„° í™•ë³´ë¥¼ ìœ„í•œ ì „ëµì„ ìˆ˜ë¦½í•˜ê³  ìˆìŠµë‹ˆë‹¤...',
    'ê³ ê° ë§ì¶¤í˜• ì¸ì‚¬ì´íŠ¸ ì œê³µì„ ìœ„í•œ ë¶„ì„ ë°©í–¥ì„ ì¡°ìœ¨í•˜ê³  ìˆìŠµë‹ˆë‹¤...',
    'ì „ë¬¸ê°€ë“¤ì˜ í˜‘ì—… ì²´ê³„ë¥¼ êµ¬ì¶•í•˜ê³  ì‘ì—…ì„ ë°°ì •í•˜ê³  ìˆìŠµë‹ˆë‹¤...',
  ],

  // ì¬ë¬´ë¶„ì„ ì—ì´ì „íŠ¸ í™œì„±í™” ì‹œ
  financial_analyst_agent: [
    'ğŸ’° ì¬ë¬´ë¶„ì„íŒ€ì´ ê¸°ì—…ì˜ ì¬ë¬´ì œí‘œë¥¼ ìƒì„¸íˆ ê²€í† í•˜ê³  ìˆìŠµë‹ˆë‹¤...',
    'ì¬ë¬´ ë¹„ìœ¨ê³¼ í˜„ê¸ˆíë¦„ ë¶„ì„ì„ ì§„í–‰í•˜ê³  ìˆìŠµë‹ˆë‹¤...',
    'ì†ìµê³„ì‚°ì„œì™€ ëŒ€ì°¨ëŒ€ì¡°í‘œë¥¼ ë©´ë°€íˆ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...',
    'ê¸°ì—…ì˜ ìˆ˜ìµì„±ê³¼ ì•ˆì •ì„± ì§€í‘œë¥¼ ê³„ì‚°í•˜ê³  ìˆìŠµë‹ˆë‹¤...',
    'ì¬ë¬´ ê±´ì „ì„±ê³¼ ì„±ì¥ ê°€ëŠ¥ì„±ì„ í‰ê°€í•˜ê³  ìˆìŠµë‹ˆë‹¤...',
    'ì£¼ìš” ì¬ë¬´ íŠ¸ë Œë“œì™€ ë³€í™” ìš”ì¸ì„ íŒŒì•…í•˜ê³  ìˆìŠµë‹ˆë‹¤...',
    'ì—…ê³„ í‰ê·  ëŒ€ë¹„ ì¬ë¬´ ì„±ê³¼ë¥¼ ë¹„êµ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...',
  ],

  // ì‹œì¥ë¶„ì„ ì—ì´ì „íŠ¸ í™œì„±í™” ì‹œ
  market_analyst_agent: [
    'ğŸ“ˆ ì‹œì¥ë¶„ì„íŒ€ì´ ì£¼ê°€ ì°¨íŠ¸ì™€ ê±°ë˜ëŸ‰ì„ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...',
    'ê¸°ìˆ ì  ì§€í‘œì™€ ì‹œì¥ ë™í–¥ì„ ë©´ë°€íˆ ê²€í†  ì¤‘ì…ë‹ˆë‹¤...',
    'ì°¨íŠ¸ íŒ¨í„´ê³¼ ì§€ì§€/ì €í•­ì„ ì„ í™•ì¸í•˜ê³  ìˆìŠµë‹ˆë‹¤...',
    'RSI, MACD ë“± ì£¼ìš” ê¸°ìˆ ì§€í‘œë¥¼ ê³„ì‚°í•˜ê³  ìˆìŠµë‹ˆë‹¤...',
    'ê±°ë˜ëŸ‰ íŒ¨í„´ê³¼ ì‹œì¥ ì‹¬ë¦¬ë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...',
    'ë‹¨ê¸° ë° ì¤‘ì¥ê¸° ê°€ê²© ì›€ì§ì„ì„ ì˜ˆì¸¡í•˜ê³  ìˆìŠµë‹ˆë‹¤...',
    'ì‹œì¥ íŠ¸ë Œë“œì™€ ë³€ê³¡ì ì„ ì‹ë³„í•˜ê³  ìˆìŠµë‹ˆë‹¤...',
  ],

  // ë‰´ìŠ¤ë¶„ì„ ì—ì´ì „íŠ¸ í™œì„±í™” ì‹œ
  news_analyst_agent: [
    'ğŸ“° ë‰´ìŠ¤ë¶„ì„íŒ€ì´ ìµœì‹  ë‰´ìŠ¤ì™€ ê³µì‹œë¥¼ ìˆ˜ì§‘í•˜ê³  ìˆìŠµë‹ˆë‹¤...',
    'ê´€ë ¨ ì–¸ë¡  ë³´ë„ì™€ ì‹œì¥ ì´ìŠˆë¥¼ ì¡°ì‚¬í•˜ê³  ìˆìŠµë‹ˆë‹¤...',
    'ê¸°ì—… ê³µì‹œì™€ ì¤‘ìš” ë°œí‘œì‚¬í•­ì„ ê²€í† í•˜ê³  ìˆìŠµë‹ˆë‹¤...',
    'ì—…ê³„ ë™í–¥ê³¼ ê²½ìŸì‚¬ ì†Œì‹ì„ íŒŒì•…í•˜ê³  ìˆìŠµë‹ˆë‹¤...',
    'ì‹œì¥ ì„¼í‹°ë¨¼íŠ¸ì™€ íˆ¬ìì ë°˜ì‘ì„ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...',
    'ë‰´ìŠ¤ê°€ ì£¼ê°€ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì„ í‰ê°€í•˜ê³  ìˆìŠµë‹ˆë‹¤...',
    'ì •ë³´ì˜ ì‹ ë¢°ì„±ê³¼ ì¤‘ìš”ë„ë¥¼ ê²€ì¦í•˜ê³  ìˆìŠµë‹ˆë‹¤...',
  ],

  // ë°±í…ŒìŠ¤íŠ¸ë¶„ì„ ì—ì´ì „íŠ¸ í™œì„±í™” ì‹œ
  risk_analyst_agent: [
    'ğŸ“Š ë°±í…ŒìŠ¤íŠ¸ë¶„ì„íŒ€ì´ íˆ¬ì ì „ëµì„ ê²€ì¦í•˜ê³  ìˆìŠµë‹ˆë‹¤...',
    'ë‹¤ì–‘í•œ ì „ëµì˜ ì„±ê³¼ë¥¼ ë°±í…ŒìŠ¤íŠ¸í•˜ê³  ìˆìŠµë‹ˆë‹¤...',
    'ìµœì ì˜ íˆ¬ì ì „ëµì„ ì°¾ê¸° ìœ„í•´ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...',
    'EMA, MACD, ê³¨ë“ í¬ë¡œìŠ¤ ì „ëµì„ ë¹„êµ ê²€ì¦í•˜ê³  ìˆìŠµë‹ˆë‹¤...',
    'ìˆ˜ìµë¥ ê³¼ ë¦¬ìŠ¤í¬ ì§€í‘œë¥¼ ì¢…í•©ì ìœ¼ë¡œ í‰ê°€í•˜ê³  ìˆìŠµë‹ˆë‹¤...',
    'ì „ëµë³„ ì„±ê³¼ë¥¼ ìƒì„¸íˆ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...',
    'ìµœì ì˜ íˆ¬ì ì „ëµì„ ë„ì¶œí•˜ê³  ìˆìŠµë‹ˆë‹¤...',
  ],

  // ë³‘ë ¬ ì²˜ë¦¬: ì—¬ëŸ¬ ì—ì´ì „íŠ¸ ë™ì‹œ í™œì„±í™”
  concurrent: [
    'ğŸ’°ğŸ“ˆ ì¬ë¬´ë¶„ì„íŒ€ê³¼ ì‹œì¥ë¶„ì„íŒ€ì´ ë™ì‹œì— ì‘ì—…í•˜ê³  ìˆìŠµë‹ˆë‹¤...',
    'ğŸ“°ğŸ“Š ë‰´ìŠ¤ë¶„ì„íŒ€ê³¼ ë°±í…ŒìŠ¤íŠ¸ë¶„ì„íŒ€ì´ ë³‘ë ¬ë¡œ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...',
    'ì—¬ëŸ¬ ì „ë¬¸íŒ€ì´ ë™ì‹œì— ì¢…í•© ë¶„ì„ì„ ì§„í–‰í•˜ê³  ìˆìŠµë‹ˆë‹¤...',
    'ê° ì „ë¬¸ ì˜ì—­ë³„ë¡œ ì‹¬ë„ìˆëŠ” ë¶„ì„ì´ ë™ì‹œì— ì´ë£¨ì–´ì§€ê³  ìˆìŠµë‹ˆë‹¤...',
    'ë‹¤ê°ë„ ê´€ì ì—ì„œ í†µí•©ì ì¸ ë¶„ì„ì„ ìˆ˜í–‰í•˜ê³  ìˆìŠµë‹ˆë‹¤...',
    'ì „ë¬¸ê°€ë“¤ì´ í˜‘ë ¥í•˜ì—¬ ì¢…í•©ì ì¸ íˆ¬ì ì¸ì‚¬ì´íŠ¸ë¥¼ ë„ì¶œí•˜ê³  ìˆìŠµë‹ˆë‹¤...',
    'ë‹¤ë©´ì  ë¶„ì„ì„ í†µí•´ ë³´ë‹¤ ì •í™•í•œ ê²°ë¡ ì„ ë„ì¶œí•˜ê³  ìˆìŠµë‹ˆë‹¤...',
  ],

  // ì¢…í•© ë‹¨ê³„: Root Agent ì™„ë£Œ ì‹œ
  synthesis: [
    'ì „ë¬¸ê°€ë“¤ì˜ ì˜ê²¬ì„ ì¢…í•©í•˜ê³  ìˆìŠµë‹ˆë‹¤...',
    'ìµœì¢… ë¶„ì„ ê²°ê³¼ë¥¼ ì •ë¦¬ ì¤‘ì…ë‹ˆë‹¤...',
    'í•µì‹¬ ì¸ì‚¬ì´íŠ¸ë¥¼ ë„ì¶œí•˜ê³  ìˆìŠµë‹ˆë‹¤...',
    'ë§ì¶¤í˜• ë‹µë³€ì„ ì¤€ë¹„í•˜ê³  ìˆìŠµë‹ˆë‹¤...',
    'ì¢…í•©ì ì¸ íˆ¬ì ê´€ì ì„ ì •ë¦¬í•˜ê³  ìˆìŠµë‹ˆë‹¤...',
    'ì‹¤í–‰ ê°€ëŠ¥í•œ íˆ¬ì ì „ëµì„ ìˆ˜ë¦½í•˜ê³  ìˆìŠµë‹ˆë‹¤...',
  ],
};

const MESSAGE_DURATION = 3500; // 3.5ì´ˆ

/**
 * ì‹¤ì‹œê°„ A2A ì—ì´ì „íŠ¸ í™œë™ ê¸°ë°˜ ì¤€ë¹„ ìƒíƒœ ê´€ë¦¬ ì»¤ìŠ¤í…€ í›…
 * - AgentWorkflowStoreì™€ ì—°ë™í•˜ì—¬ ì‹¤ì œ ì—ì´ì „íŠ¸ ìƒíƒœ ë°˜ì˜
 * - ë™ì  ë©”ì‹œì§€ ì„ íƒ ë° ìˆœí™˜
 * - ë³‘ë ¬ ì²˜ë¦¬ ìƒí™© ì§€ì›
 */
export function useAgentPreparation(isActive: boolean) {
  // AgentMonitor íŒ¨í„´ ì¬ì‚¬ìš©
  const activeAgents = useAgentWorkflowStore((state) => state.activeAgents);

  const [currentMessageIndex, setCurrentMessageIndex] = useState(0);
  const [isTextVisible, setIsTextVisible] = useState(true);
  const intervalRef = useRef<NodeJS.Timeout | null>(null);

  // í˜„ì¬ ë©”ì‹œì§€ ê°€ì ¸ì˜¤ê¸° - ë‹¨ìˆœí™”
  const getCurrentMessage = (): string => {
    // í•­ìƒ initial ì¹´í…Œê³ ë¦¬ ë©”ì‹œì§€ë¥¼ ì‚¬ìš© (ë‹¨ìˆœí™”)
    const messages = AGENT_MESSAGES.initial;
    const message =
      messages[currentMessageIndex % messages.length] || 'ë¶„ì„ì„ ì¤€ë¹„í•˜ê³  ìˆìŠµë‹ˆë‹¤...';
    return message;
  };

  // ë‹¨ì¼ useEffectë¡œ ëª¨ë“  ìƒíƒœ ê´€ë¦¬
  useEffect(() => {
    // ì •ë¦¬ í•¨ìˆ˜ ë¨¼ì € ì‹¤í–‰
    if (intervalRef.current) {
      clearInterval(intervalRef.current);
      intervalRef.current = null;
    }

    if (!isActive) {
      setCurrentMessageIndex(0);
      setIsTextVisible(true);
      return;
    }

    // ì´ˆê¸° ìƒíƒœ ì„¤ì •
    setCurrentMessageIndex(0);
    setIsTextVisible(true);

    // ë©”ì‹œì§€ ìˆœí™˜ ì‹œì‘
    intervalRef.current = setInterval(() => {
      setCurrentMessageIndex((prev) => (prev + 1) % AGENT_MESSAGES.initial.length);
    }, MESSAGE_DURATION);

    // cleanup
    return () => {
      if (intervalRef.current) {
        clearInterval(intervalRef.current);
        intervalRef.current = null;
      }
    };
  }, [isActive]); // isActiveë§Œ ì˜ì¡´

  return {
    currentMessage: getCurrentMessage(),
    isTextVisible,
    currentPhase: 'initial',
    activeAgentCount: activeAgents.length,
    messageCount: AGENT_MESSAGES.initial.length,
  };
}
